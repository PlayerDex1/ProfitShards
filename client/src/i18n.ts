import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

type Lang = 'pt' | 'en';

type Dict = Record<string, string>;

const dicts: Record<Lang, Dict> = {
  pt: {
    'header.title': 'ProfitShards',
    'header.subtitle': 'Otimize seu lucro no Worldshards com builds e cálculos inteligentes',
    'header.login': 'Entrar',
    'header.logout': 'Sair',
    'header.theme': 'Alternar tema',
    'header.lang': 'Idioma',

    'auth.title': 'Entrar',
    'auth.username': 'Apelido',
    'auth.password': 'Senha',
    'auth.cancel': 'Cancelar',
    'auth.login': 'Entrar',
    'auth.note': 'As credenciais ficam apenas no seu navegador.',

    'equipment.title': 'Equipamento - ',
    'equipment.config': 'Configuração de equipamento para esta sessão',
    'equipment.rarity': 'Raridade',
    'equipment.luck': 'Sorte',
    'equipment.totalLuck': 'Total de Sorte',
    'equipment.save': 'Salvar',
    'equipment.cancel': 'Cancelar',
    'equipment.apply': 'Aplicar',
    'equipment.applyBuildB': 'Aplicar Build B',
    'equipment.builds': 'Builds Salvas',
    'equipment.builds.none': 'Nenhuma build salva ainda',
    'equipment.builds.name': 'Nome da build',
    'equipment.export': 'Exportar (copiar)',
    'equipment.import': 'Importar',
    'equipment.exportFile': 'Baixar JSON',
    'equipment.importFile': 'Carregar JSON',
    'equipment.share': 'Compartilhar link',
    'equipment.compare': 'Comparar Builds',
    'equipment.selectA': 'Selecione Build A',
    'equipment.selectB': 'Selecione Build B',
    'equipment.luckA': 'Sorte A',
    'equipment.luckB': 'Sorte B',
    'equipment.diff': 'Diferença',
    'equipment.effect': 'Efeito estimado',
    'equipment.tip.title': 'Dica',
    'equipment.tip.body': 'Use os presets de raridade e os botões ± para ajustes rápidos. Suas builds e sessões são salvas por usuário.',
    'equipment.whatif': 'What‑if de Sorte',
    'equipment.whatif.hint': 'Ajuste para simular total de Sorte e ver impacto nos cálculos.',
    'equipment.compareNote': 'A diferença e o efeito são estimativas baseadas apenas na Sorte total.',
    'equipment.import.prompt': 'Cole o JSON das builds:',
    'equipment.button': 'Equipamento (Sorte: {luck})',
    'equipment.slot.weapon': 'Arma',
    'equipment.slot.axe': 'Machado',
    'equipment.slot.armor': 'Armadura',
    'equipment.slot.pickaxe': 'Picareta',
    'equipment.rarity.comum': 'Comum',
    'equipment.rarity.incomum': 'Incomum',
    'equipment.rarity.raro': 'Raro',
    'equipment.rarity.épico': 'Épico',
    'equipment.rarity.lendário': 'Lendário',
    'equipment.rarity.mítico': 'Mítico',

    'results.totalTokenValue': 'Valor Total dos Tokens',
    'results.gemsCost': 'Custo das Gemas',
    'results.grossProfit': 'Lucro Bruto',
    'results.rebuyCost': 'Custo Recompra Gemas',
    'results.roi': 'ROI',
    'results.no_history': 'Nenhum cálculo salvo ainda',
    'results.history_will_appear': 'Seus cálculos aparecerão aqui automaticamente',
    'results.finalProfitTitle': 'Lucro Líquido Final',
    'results.finalProfit': 'FinalProfit',
    'results.profitable': 'Investimento Lucrativo',
    'results.loss': 'Prejuízo',
    'results.summaryTitle': 'Resumo',
    'results.tokenDistribution': 'Distribuição de Tokens',
    'results.equipTokens': 'Token gasto na aceleração',
    'results.farmedTokens': 'Tokens Farmados',
    'results.totalTokensCount': 'Total de Tokens',
    'results.efficiencyMetrics': 'Métricas de Eficiência',
    'results.totalTokensLabel': 'Total de Tokens',
    'results.farmEfficiency': 'Eficiência Farm',
    'results.performanceOverTime': 'Performance ao Longo do Tempo',
    'results.history.title': 'Histórico de Cálculos',
    'results.history.show': 'Mostrar',
    'results.history.hide': 'Ocultar',
    'results.history.clear': 'Limpar',
    'results.history.clickToShow': 'Clique em "Mostrar" para ver o histórico',
    'results.tokenLabel': 'Tokens',
    'results.profitLabel': 'Lucro',

    '404.title': '404 Página não encontrada',
    '404.hint': 'Você esqueceu de adicionar a página ao roteador?',

    'calc.title': 'Calculadora',
    'calc.investment': 'Investimento Inicial (USD)',
    'calc.gemsConsumed': 'Gemas Consumidas',
    'calc.loadsUsed': 'Cargas Utilizadas',
    'calc.gemsPurchased': 'Gemas Compradas',
    'calc.tokensEquipment': 'Token gasto na aceleração',
    'calc.tokenPrice': 'Preço Token (USD)',
    'calc.gemsRemaining': 'Gemas Restantes',
    'calc.tokensFarmed': 'Tokens Farmados',
    'calc.gemPrice': 'Preço Gema (USD)',
    'calc.button': 'Calcular Lucro Líquido',

    'sidebar.summary': 'Resumo Rápido',
    'sidebar.totalProfit': 'Lucro Total',
    'sidebar.roi': 'ROI',
    'sidebar.efficiency': 'Eficiência',
    'sidebar.nav.calculator': 'Calculadora',
    'sidebar.nav.equipment': 'Equipamentos',
    'sidebar.nav.history': 'Histórico',

    'home.calculator': 'Calculadora',

    'donate.title': 'Doação',
    'donate.openloot': 'Creator OL',
    'donate.wallet': 'Carteira EVM',
    'donate.copy': 'Copiar',
    'donate.copied': 'Copiado!',
    'planner.title': 'Planejador de Mapa',
    'planner.mapSize': 'Tamanho do mapa',
    'planner.small': 'Pequeno',
    'planner.medium': 'Médio',
    'planner.large': 'Grande',
    'planner.xlarge': 'Extra grande',
    'planner.energyCost': 'Energia por mapa',
    'planner.loads': 'Cargas (nº de runs)',
    'planner.tokensDropped': 'Tokens dropados',
    'planner.apply': 'Salvar no mini histórico',
    'planner.example': 'ex.: 30 no mapa médio',
    'planner.history': 'Mini histórico (2 dias)',
    'planner.noHistory': 'Nenhum registro de drop nos últimos 2 dias',
    'planner.when': 'Quando',
    'metrics.title': 'Métricas (últimos 2 dias)',
    'metrics.title24h': 'Métricas (últimas 24h)',
    'metrics.avgPerRun': 'Média de tokens por carga',
    'metrics.totalByDay': 'Total por dia',
    'metrics.bestHour': 'Melhor horário',
    'metrics.noData': 'Sem dados suficientes',
    'metrics.runShort': 'carga',
    'planner.clear': 'Limpar histórico',
    'planner.delete': 'Excluir',
  },
  en: {
    'header.title': 'ProfitShards',
    'header.subtitle': 'Optimize your Worldshards profits with smart builds and calculations',
    'header.login': 'Sign in',
    'header.logout': 'Sign out',
    'header.theme': 'Toggle theme',
    'header.lang': 'Language',

    'auth.title': 'Sign in',
    'auth.username': 'Nickname',
    'auth.password': 'Password',
    'auth.cancel': 'Cancel',
    'auth.login': 'Sign in',
    'auth.note': 'Credentials are stored only in your browser.',

    'equipment.title': 'Equipment - ',
    'equipment.config': 'Equipment configuration for this session',
    'equipment.rarity': 'Rarity',
    'equipment.luck': 'Luck',
    'equipment.totalLuck': 'Total Luck',
    'equipment.save': 'Save',
    'equipment.cancel': 'Cancel',
    'equipment.apply': 'Apply',
    'equipment.applyBuildB': 'Apply Build B',
    'equipment.builds': 'Saved Builds',
    'equipment.builds.none': 'No builds saved yet',
    'equipment.builds.name': 'Build name',
    'equipment.export': 'Export (copy)',
    'equipment.import': 'Import',
    'equipment.exportFile': 'Download JSON',
    'equipment.importFile': 'Upload JSON',
    'equipment.share': 'Share link',
    'equipment.compare': 'Compare Builds',
    'equipment.selectA': 'Select Build A',
    'equipment.selectB': 'Select Build B',
    'equipment.luckA': 'Luck A',
    'equipment.luckB': 'Luck B',
    'equipment.diff': 'Difference',
    'equipment.effect': 'Estimated effect',
    'equipment.tip.title': 'Tip',
    'equipment.tip.body': 'Use rarity presets and ± buttons for quick adjustments. Your builds and sessions are saved per user.',
    'equipment.whatif': 'Luck What‑if',
    'equipment.whatif.hint': 'Adjust to simulate total Luck and see impact.',
    'equipment.compareNote': 'Difference and effect are estimates based only on total Luck.',
    'equipment.import.prompt': 'Paste builds JSON:',
    'equipment.button': 'Equipment (Luck: {luck})',
    'equipment.slot.weapon': 'Weapon',
    'equipment.slot.axe': 'Axe',
    'equipment.slot.armor': 'Armor',
    'equipment.slot.pickaxe': 'Pickaxe',
    'equipment.rarity.comum': 'Common',
    'equipment.rarity.incomum': 'Uncommon',
    'equipment.rarity.raro': 'Rare',
    'equipment.rarity.épico': 'Epic',
    'equipment.rarity.lendário': 'Legendary',
    'equipment.rarity.mítico': 'Mythic',

    'results.totalTokenValue': 'Total Token Value',
    'results.gemsCost': 'Gems Cost',
    'results.grossProfit': 'Gross Profit',
    'results.rebuyCost': 'Gems Rebuy Cost',
    'results.roi': 'ROI',
    'results.no_history': 'No calculations saved yet',
    'results.history_will_appear': 'Your calculations will appear here automatically',
    'results.finalProfitTitle': 'Final Net Profit',
    'results.finalProfit': 'FinalProfit',
    'results.profitable': 'Profitable Investment',
    'results.loss': 'Loss',
    'results.summaryTitle': 'Summary',
    'results.tokenDistribution': 'Token Distribution',
    'results.equipTokens': 'Acceleration token spent',
    'results.farmedTokens': 'Farmed Tokens',
    'results.totalTokensCount': 'Total Tokens',
    'results.efficiencyMetrics': 'Efficiency Metrics',
    'results.totalTokensLabel': 'Total Tokens',
    'results.farmEfficiency': 'Farm Efficiency',
    'results.performanceOverTime': 'Performance Over Time',
    'results.history.title': 'Calculations History',
    'results.history.show': 'Show',
    'results.history.hide': 'Hide',
    'results.history.clear': 'Clear',
    'results.history.clickToShow': 'Click "Show" to view history',

    '404.title': '404 Page Not Found',
    '404.hint': 'Did you forget to add the page to the router?',

    'results.tokenLabel': 'Tokens',
    'results.profitLabel': 'Profit',

    'calc.title': 'Calculator',
    'calc.investment': 'Initial Investment (USD)',
    'calc.gemsConsumed': 'Gems Consumed',
    'calc.loadsUsed': 'Loads Used',
    'calc.gemsPurchased': 'Gems Purchased',
    'calc.tokensEquipment': 'Acceleration token spent',
    'calc.tokenPrice': 'Token Price (USD)',
    'calc.gemsRemaining': 'Gems Remaining',
    'calc.tokensFarmed': 'Farmed Tokens',
    'calc.gemPrice': 'Gem Price (USD)',
    'calc.button': 'Calculate Net Profit',

    'sidebar.summary': 'Quick Summary',
    'sidebar.totalProfit': 'Total Profit',
    'sidebar.roi': 'ROI',
    'sidebar.efficiency': 'Efficiency',
    'sidebar.nav.calculator': 'Calculator',
    'sidebar.nav.equipment': 'Equipment',
    'sidebar.nav.history': 'History',

    'home.calculator': 'Calculator',

    'donate.title': 'Donation',
    'donate.openloot': 'Creator OL',
    'donate.wallet': 'EVM Wallet',
    'donate.copy': 'Copy',
    'donate.copied': 'Copied!',
    'planner.title': 'Map Planner',
    'planner.mapSize': 'Map size',
    'planner.small': 'Small',
    'planner.medium': 'Medium',
    'planner.large': 'Large',
    'planner.xlarge': 'Extra large',
    'planner.energyCost': 'Energy per map',
    'planner.loads': 'Loads (runs)',
    'planner.tokensDropped': 'Tokens dropped',
    'planner.apply': 'Save to mini history',
    'planner.example': 'e.g., 30 on medium map',
    'planner.history': 'Mini history (2 days)',
    'planner.noHistory': 'No drop records in last 2 days',
    'planner.when': 'When',
    'metrics.title': 'Metrics (last 2 days)',
    'metrics.title24h': 'Metrics (last 24h)',
    'metrics.avgPerRun': 'Avg tokens per load',
    'metrics.totalByDay': 'Total per day',
    'metrics.bestHour': 'Best hour',
    'metrics.noData': 'No data yet',
    'metrics.runShort': 'load',
    'planner.clear': 'Clear history',
    'planner.delete': 'Delete',
  },
};

const LangContext = createContext<{ lang: Lang; setLang: (l: Lang) => void; t: (k: string) => string }>({ lang: 'pt', setLang: () => {}, t: (k) => k });

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLangState] = useState<Lang>('pt');

  useEffect(() => {
    const saved = localStorage.getItem('worldshards-lang') as Lang | null;
    if (saved === 'en' || saved === 'pt') setLangState(saved);
  }, []);

  const setLang = (l: Lang) => {
    setLangState(l);
    localStorage.setItem('worldshards-lang', l);
    window.dispatchEvent(new CustomEvent('worldshards-lang-updated'));
  };

  const t = useMemo(() => (key: string) => dicts[lang][key] ?? key, [lang]);

  return React.createElement(LangContext.Provider, { value: { lang, setLang, t } }, children);
}

export function useI18n() {
  return useContext(LangContext);
}